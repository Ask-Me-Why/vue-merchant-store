webpackJsonp([4],{kbIc:function(t,e){},nXCx:function(t,e){},vF69:function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var s=i("0xDb"),n=i("lC5x"),r=i.n(n),o=i("J0Oq"),a=i.n(o),c=i("IHPB"),d=i.n(c),l=i("+vOg"),u={name:"OrderGroup",inject:["rootMain"],props:{show:!1,type:{default:1,type:String|Number}},data:function(){return{orders:[],loader:!1,offset:0,infiniteMore:!1,orderServer:new l.c}},computed:{twoFloat:function(){return s.n}},mounted:function(){this.show&&this.getOrder()},methods:{getOrder:function(){var t=this;this.loader=!0,this.orderServer.all({status:this.type,offset:this.offset}).then(function(e){if(t.loader=!1,e.data.ok&&t.show){var i=[];e.data.list.length>0&&(e.data.list.map(function(t){var e=0;t.good_info.length>0&&(e=t.good_info.reduce(function(t,e){return t+Number(e.count)*Number(Object(s.n)(e.price))},0)),t.my_total=Object(s.n)(e),i.push(t)}),t.orders=[].concat(d()(t.orders),i)),t.infiniteMore=e.data.hasmore,t.offset++}else t.infiniteMore=!1},function(e){t.loader=!1,t.infiniteMore=!1})},onInfinite:function(t){var e=this;return a()(r.a.mark(function i(){return r.a.wrap(function(i){for(;;)switch(i.prev=i.next){case 0:if(e.infiniteMore&&!e.loader){i.next=3;break}return t(),i.abrupt("return");case 3:return i.next=5,e.getOrder();case 5:t();case 6:case"end":return i.stop()}},i,e)}))()},removeOrder:function(t){var e=this;Object(s.e)({title:"提示",theme:"accent",content:'确认取消订单号为"'+t.order_id+'"的订单？',shadeClick:!1,showClose:!1},function(i){e.rootMain.loader(!0),e.orderServer.remove(t.order_id).then(function(i){if(e.rootMain.loader(!1),i.data.ok){var s=e.orders.findIndex(function(e){return e.order_id==t.order_id});-1!=s&&e.orders.splice(s,1),e.$nextTick(function(){e.needRequest()})}},function(t){e.rootMain.loader(!1)}),i.close()},function(t){})},needRequest:function(){var t=this.$el.offsetHeight,e=this.$el.querySelector(".ask-scroll-body");(e&&e.offsetHeight||0)-t<100&&this.getOrder()},payOrder:function(t){var e=this;this.$jsBridge.callHandler("pospay",{orderid:t.order_id,type:t.xuid&&0!=t.xuid?"webshophy":"webshoppt"},function(i){if("string"==typeof i&&(i=JSON.parse(i)),1==i.retcode){Object(s.f)({msg:"支付成功",class:"success",time:2e3});var n=e.orders.findIndex(function(e){return e.order_id==t.order_id});-1!=n&&e.orders.splice(n,1),e.$nextTick(function(){e.needRequest()})}else Object(s.f)({msg:"支付失败",class:"danger",time:2e3})})}},watch:{show:function(t,e){this.offset=0,this.infiniteMore=!0,this.orders=[],t&&this.getOrder()}}},v={render:function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("ask-scroll",{directives:[{name:"show",rawName:"v-show",value:t.show,expression:"show"}],staticClass:"noscroll",attrs:{"on-infinite":t.onInfinite}},[i("div",{staticClass:"order-group"},[t._l(t.orders,function(e,s){return[i("div",{key:s,staticClass:"og-once"},[i("div",{staticClass:"og-otitle"},[i("div",{staticClass:"name"},[t._v("订单号:"+t._s(e.order_id))]),t._v(" "),i("div",{staticClass:"state",class:{pay:2==t.type},domProps:{textContent:t._s(1==t.type?"待付款":"已支付")}})]),t._v(" "),i("div",{staticClass:"og-oinfo"},[t._l(e.good_info,function(e,s){return[i("div",{staticClass:"og-ogroup"},[i("div",{staticClass:"cover"},[i("div",{staticClass:"cover-box"},[i("img",{attrs:{src:e.pic,alt:"封面图"}})])]),t._v(" "),i("div",{staticClass:"detail"},[i("div",{staticClass:"title"},[t._v(t._s(e.name))]),t._v(" "),i("div",{staticClass:"other"},[i("div",{staticClass:"price"},[t._v("￥"+t._s(t.twoFloat(e.price)))]),t._v(" "),i("div",{staticClass:"num"},[t._v("x"+t._s(e.count))])])])])]})],2),t._v(" "),i("div",{staticClass:"og-ofooter"},[i("div",{staticClass:"og-otext"},[t._v("共"+t._s(e.good_info.length)+"件商品")]),t._v(" "),i("div",{staticClass:"og-otext large"},[t._v("合计:\n\t\t\t\t\t\t"),i("span",[t._v("￥"+t._s(e.my_total))])])]),t._v(" "),1==t.type?i("div",{staticClass:"og-obtns"},[i("ask-button",{staticClass:"default",attrs:{text:"取消订单"},nativeOn:{click:function(i){t.removeOrder(e)}}}),t._v(" "),i("ask-button",{staticClass:"primary",attrs:{text:"付款"},nativeOn:{click:function(i){t.payOrder(e)}}})],1):t._e()])]})],2),t._v(" "),i("ask-inline-loader",{attrs:{show:t.loader}}),t._v(" "),t.infiniteMore?t._e():i("template",{slot:"infinite"},[i("div",{staticClass:"bottom-line-text"},[i("span",[0==t.orders.length?[t._v("暂无数据")]:[t._v("已加载全部数据")]],2)])])],2)},staticRenderFns:[]};var f={name:"Order",components:{"order-group":i("Z0/y")(u,v,!1,function(t){i("nXCx")},null,null).exports},data:function(){return{defaultActive:0,swiper:null}},computed:{currentActive:function(){return this.defaultActive},swoptions:function(){var t=this;return{initialSlide:this.defaultActive,on:{init:function(){t.defaultActive=this.activeIndex,t.swiper=this},slideChangeTransitionStart:function(){t.defaultActive=this.activeIndex,t.swiper=this}}}}},mounted:function(){0!=this.$route.params.type&&1!=this.$route.params.type||(this.defaultActive=this.$route.params.type)},methods:{onClick:function(t){this.defaultActive=t,this.swiper&&this.swiper.slideTo(this.defaultActive)}}},p={render:function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{directives:[{name:"nav",rawName:"v-nav",value:t.$route.meta,expression:"$route.meta"}],staticClass:"ask-view"},[i("div",{staticClass:"ask-view-box"},[i("div",{ref:"navEl",staticClass:"ms-order-nav"},[i("div",{staticClass:"ms-ononce",class:{active:0==t.currentActive},on:{click:function(e){t.onClick(0)}}},[t._v("\n\t\t\t\t待付款\n\t\t\t")]),t._v(" "),i("div",{staticClass:"ms-ononce",class:{active:1==t.currentActive},on:{click:function(e){t.onClick(1)}}},[t._v("\n\t\t\t\t已支付\n\t\t\t")])]),t._v(" "),i("ask-swiper",{staticClass:"ms-order-body",attrs:{options:t.swoptions}},[i("ask-slide",[i("order-group",{attrs:{show:0==t.currentActive,type:1}})],1),t._v(" "),i("ask-slide",[i("order-group",{attrs:{show:1==t.currentActive,type:2}})],1)],1)],1)])},staticRenderFns:[]};var h=i("Z0/y")(f,p,!1,function(t){i("kbIc")},null,null);e.default=h.exports}});