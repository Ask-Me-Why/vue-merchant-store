webpackJsonp([3],{CduL:function(t,e){},RZvp:function(t,e){t.exports="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAE8AAABHBAMAAAC0SQfYAAAABGdBTUEAALGPC/xhBQAAAAFzUkdCAK7OHOkAAAAkUExURUxpcSWr7CWr7CWr7CWr7CWr7CWr7CWr7CWr7CWr7CWr7CWr7PuHNrkAAAALdFJOUwAg7Z1tPbiES9MKh78kvwAAAYhJREFUSMft1L9PwkAUB/BXDaCdqotGFidjZGFnYXCiC4MkJixEk4vYhc1ElqKRXGRpjIthIcaB1QIJ+P45+wvKtX3XDg4O/U7k+uHuXq/3ANwYuACoIc4BytiDPiJ2QLGhPCsg/kCYmgxeJMNDB+o5zGEOcxiHBi6jLcUCBYXeM2TsFq75K8Ax5wOAKdfcX7wJ6gtMByrnZokxZnr/Bnl2HFL1Z3x+eCSQ2mpp7oz1dTHfBNxDZ89h+gFUDsKceCNOMfU4PHrDMPY7CQsVFHJPwU/R4YyC/QjEJgHHUdj7C7iux06DjeAtfqVBKxjZT4MrzT+icTL0z9pwH557A0/eRuuxs766bHjczd0E1KFfkenMyLpm7EvR/cdn7CYoXSM+qXbkNa6oLznprBOzG4FLChYi8JS8RePYURMZCc6ekLAowDl9gRUBWpKrrm9DTQKL2VYW1+5I28woS83i2kt541I3PaCa0uLa2VYGKAVwAWmpZKl5C6ZtcVPNv4aYsWq1++Eldg1+AZaO1/eJlHgkAAAAAElFTkSuQmCC"},hcCh:function(t,e){t.exports="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAE8AAABSCAMAAAAionnxAAAABGdBTUEAALGPC/xhBQAAAAFzUkdCAK7OHOkAAAB+UExURUxpcVl2yHuS1MLO7T1fvvD1/Zms3v///93l9zhavUtqw0FiwEhowkpqwzdZvEpqw+br+Etrw3iQ05Ck205txZqt39zl9////+nw++70/eTr+URlwSpPuIGY1nKL0ff5/TdavdXf9ExrxFd1yLvJ64+j26++5mWAzaGz4cnV8EZ8GboAAAAWdFJOUwB2dnP+c3Nzc3G0WezdOs98lru0H6p1rE34AAAEW0lEQVRYw+2Zi5KqOBCGBwmKCDo6nhgSIHKH93/B04SLkISLM1O1W1v7T1llofPZSXeH7ubjQ+hsXB2NLpKc6+n+sa779eIi9NQITfREruecV3Enhz1ZWkYahaDo9VcmCF2MNZyHUFlldawTjvFIcREy5C4DzxfE8pj4U/GHEJcu+7hKkHta2juHsZxygqeihAqRqYGU+wC8LDjl5KIIc5mGs6pVJn2COclRsmCgg9KMU+mf/LoMGt8+g7L2pZ/y6xQ58wZ6KIp9vJ2HCQ2RNx80LsqpwqM0y1tlVLadkJwteMQFb5DWAz4Z5PPWs3ziYNLyKsbWeYRq4y+uR8Kk5xlr6yVxNUmMUqewJnTVPsEjNGfBqp4hWLiBB18Ch6a65H0pD+Er4O2NvDSAH5+q8ccoA0kOPPIGz38siudv2kf+5ym8zh/Xk6Lz/X1eknU8x1B1FPeqV/yt8qrnwPsyhWzb7N7AayeAHS9+j/fHPnSyBtkAHPLtTd4XWLZvZL90AOBZtY9rpPIs0zg2Mq2BZ8G1k8LDhUY1l9dr2XtjBzKtEdBWeXWJmCKUFFzeP0tWw9sdJR4JAw2PBWU85d32skwtj0YBS1QFqcRzjrLEyhUeL1Cgq4sqf8U+47jX8R6kCFXlBVX8cZhqN8MDIiXKuaqJl828tXimpEjY1+d/hden2GQH+Spv3/M8FOLReeBX3X1ycnPP8QrPmuHxCkk1uKjDu89evJs5kjVvn8gPkWKz+SF4k/N5Z8/yIH+19kVY4k1yzZzfv7psLEunSsrsscAz9PZFdDj/Mkmx7N9J/tqHBd734s/6Zd7P7RudzD+yj7b7t9vvBjUB+D0eKzreerxEv8vDb/JeqzWMvfVj3s0cFwaHH/NW4++HvG/ZV6DftW+BJ+w7/Mvt+4d5jxHvtoW3cv99ZB0vSzfxyrqd2cyqQqha4k38GwasbZrTWbHu/NPzdmMebEq63k+zHPc8W9LAu6CwmZdQmg3V3qwKTHHLU/qjY79/l27+AlUf7UZMIEqglRavVzUI1yie4xn7rn7ueT2wpRJOmglMQXn/K0K4593aXmvot5q3Em86tMFiPsHCmiiznnb/Dpa528GtV+4XtDzAPQOWJkEQxkTL+4SMbap6+9XOLPD8AlqOLM6iAFU+1fJM8AD0XGPgLI9QaHULaNsyMfXQrhcK0sPBhNplCw+iu4w55U0WxnqeSIitvM4+LuybX2/XxUx5z9n9w9r9I/Ah2KfzR9OvNvNJvX+TMn2qy23mfyhp+ksRL5bcTxtQ4BPVwFjEHwqV8STm0NJ6n00V1L6kfv9+AQMfVAHSIozCCsurxZyEKJmU45323YADDCxr7qtjTYq7jB37gkP3htyrdlzSTmDuV4bKjMqDa9HDNGfC5CKtQ4Y846xTP/M9O9DQh0WtKFNU5CUC3MoA/3z1EEpSZbypntAJQq5zWn9ecXI8F22Q612MLQ9AgKh5nnJVZKw+TvkL14TXkKFhHVIAAAAASUVORK5CYII="},hiPH:function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=s("4YfN"),a=s.n(i),n=s("lC5x"),o=s.n(n),c=s("J0Oq"),r=s.n(c),d=s("3cXf"),l=s.n(d),u=s("0xDb"),v=s("tHyW"),h=s("+vOg"),m=s("9LpB"),f=(s("IcnI"),s("MVMM"),{name:"Clearing",inject:["rootMain"],components:{"slide-sub":v.a},data:function(){return{memberShow:!1,show:!1,member:{tip:"当前为普通收款，我要切换为",btn:"会员到店",type:1,id:null,name:"张某某",phone:"18751234562",code:null},modelData:{card:null,phone:null,verif:null},phoneRex:/^[1]{1}[34578]{1}[0-9]{9}$/,codeText:"验证码",codeDisabled:!1,sureButton:!1,infoStyle:{},posId:0,discount:1,discountNeddActive:!0,discountPrice:0,realDiscountPrice:"0.00",discountModalShow:!1}},computed:{cartList:function(){return this.$store.getters["cartModule/getAllCart"]},allPrice:function(){var t=0;return this.cartList.length>0&&(t=this.cartList.reduce(function(t,e){return(100*t+e.count*e.price*100)/100},0)),Object(u.d)(Object(u.n)(t))},needPayPrice:function(){return Object(u.d)(Object(u.n)((100*this.allPrice-100*this.realDiscountPrice)/100))},orderData:function(){var t=[];return this.cartList.length>0&&this.cartList.map(function(e){t.push([e.id,e.count])}),l()(t)},nav_meta:function(){var t={onBack:function(){var t=this;m.a.closeAll(),Object(u.e)({title:"提示",theme:"accent",content:"确认离开？",shadeClick:!1,showClose:!1},function(e){e.close(),t.$router?t.$router.back():window.history.back()})}};return Object(u.k)(!0,this.$route.meta,t)}},mounted:function(){var t=this.$refs.footerEl?this.$refs.footerEl.offsetHeight+20:74;t=t+.5|0,this.infoStyle={"padding-bottom":t+"px"}},methods:{sureDiscountModal:function(){this.realDiscountPrice=Object(u.d)(Object(u.n)(this.discountPrice)),this.discountModalShow=!1},cancelDiscountChoose:function(){this.discountNeddActive=!1},changeDiscount:function(t){this.discountNeddActive=!0,this.discount=t;var e=0;e=100*this.allPrice-this.allPrice*this.discount*100,e/=100,this.discountPrice=Object(u.d)(Object(u.n)(e))},chooseType:function(t){var e=this;return r()(o.a.mark(function s(){return o.a.wrap(function(s){for(;;)switch(s.prev=s.next){case 0:e.modelData={card:null,phone:null,verif:null},e.show=!1,3==t?e.$jsBridge.callHandler("launchScan",{title:"获取付款码"},function(t){t&&(e.modelData.card=t,e.useCardGetInfo({pay_code:e.modelData.card}))}):2==t?e.$jsBridge.callHandler("getMemberCardNo",{title:"获取会员卡号"},function(t){t&&(e.modelData.card=t,e.useCardGetInfo({card:e.modelData.card}))}):e.openMemberModal();case 3:case"end":return s.stop()}},s,e)}))()},openModal:function(){this.show=!0},closeModal:function(t){t()},openMemberModal:function(){this.memberShow=!0},closeMemberModal:function(){this.memberShow=!1,this.sureButton=!1},changeType:function(){var t={};1==this.member.type?this.openModal():(t.tip="当前为普通收款，我要切换为",t.btn="会员到店",t.type=1,this.member.order_code=null),this.member=Object(u.k)(!0,this.member,t)},validatePhone:function(){return this.modelData.phone?!!this.phoneRex.test(this.modelData.phone)||(Object(u.f)({msg:"手机号格式不对！",class:"danger",time:2e3}),!1):(Object(u.f)({msg:"请输入您的手机号！",class:"danger",time:2e3}),!1)},sendCode:function(){var t=this;if(this.validatePhone()){var e=new h.b;this.codeDisabled=!0;var s=60,i=setInterval(function(){s--,t.codeText=s+"s",(s<0||!t.memberShow)&&(t.codeText="验证码",t.codeDisabled=!1,clearInterval(i))},1e3);e.sendCode(this.modelData.phone).then(function(e){e.data.ok&&(Object(u.f)({msg:"验证码已发送",class:"success",time:2e3}),t.sureButton=!0)},function(t){Object(u.f)({msg:"网络请求错误",class:"success",time:2e3})})}},usePhoneGetInfo:function(){if(this.validatePhone())return this.modelData.verif?void this.useCardGetInfo({phone:this.modelData.phone,code:this.modelData.verif}):(Object(u.f)({msg:"请输入验证码",class:"danger",time:2e3}),!1)},useCardGetInfo:function(t){var e=this;(new h.b).getInfo(t).then(function(t){t.data.ok&&(e.member.tip="欢迎会员"+t.data.name+"到店",e.member.btn="普通收款",e.member.type=2,e.member.id=t.data.id,e.member.name=t.data.name,e.member.phone=t.data.phone,e.member.order_code=t.data.order_code,e.closeMemberModal())},function(t){Object(u.f)({msg:"网络请求错误",class:"success",time:2e3})})},pay:function(){var t=this,e={};e.order_code=this.member.order_code||"",e.amount=this.needPayPrice,e.extra_data={discount:this.realDiscountPrice},e.goods_list=this.cartList.reduce(function(t,e){var s={goods_id:e.id,name:e.name,num:e.count,price:e.price,goods_no:e.goods_no};return t.push(s),t},[]),this.$jsBridge.isInit&&"no"==this.$jsBridge.isInit&&this.rootMain.loader(!1),this.$jsBridge.callHandler("buildGoodsOrder",a()({title:"pos支付"},e),function(e){t.$store.dispatch("cartModule/clearCart"),"string"==typeof e&&(e=JSON.parse(e)),1==e.retcode?t.$router.back():t.$router.askForward({path:"/order/0",query:t.$route.query})})}},watch:{"modelData.phone":function(t,e){var s=(""+t).replace(/\D/g,"");s.length>11&&(s=s.substr(0,11)),this.modelData.phone=s},discountPrice:function(t,e){var s=(""+t).split(".");s.length>1?(s[1].length>2&&(s[1]=s[1].substr(0,2)),this.discountPrice=s[0]+"."+s[1]):this.discountPrice=t}}}),p={render:function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{directives:[{name:"nav",rawName:"v-nav",value:t.nav_meta,expression:"nav_meta"}],staticClass:"ask-view"},[i("div",{staticClass:"ask-view-box",style:t.infoStyle},[i("header",{staticClass:"ms-clearing-header"},[i("div",{staticClass:"ms-chbar"},[i("div",{staticClass:"text",domProps:{textContent:t._s(t.member.tip)}}),t._v(" "),i("div",{staticClass:"btn"},[i("ask-button",{attrs:{hover:!1,text:t.member.btn},nativeOn:{click:function(e){return t.changeType(e)}}})],1)]),t._v(" "),i("slide-sub",{staticClass:"ms-chinfo",attrs:{show:2==t.member.type}},[i("div",{staticClass:"ms-chonce"},[i("div",{staticClass:"name"},[t._v("姓名：")]),t._v(" "),i("div",{staticClass:"value",domProps:{textContent:t._s(t.member.name)}})]),t._v(" "),i("div",{staticClass:"ms-chonce"},[i("div",{staticClass:"name"},[t._v("电话：")]),t._v(" "),i("div",{staticClass:"value",domProps:{textContent:t._s(t.member.phone)}})])])],1),t._v(" "),i("section",{staticClass:"ms-clearing-body"},[t._m(0),t._v(" "),i("div",{staticClass:"ms-cbinfo"},[t._l(t.cartList,function(e,s){return[i("div",{staticClass:"ms-cbgroup"},[i("div",{staticClass:"cover"},[i("div",{staticClass:"cover-box"},[i("img",{attrs:{src:e.pic,alt:"封面图"}})])]),t._v(" "),i("div",{staticClass:"detail"},[i("div",{staticClass:"title"},[t._v(t._s(e.name))]),t._v(" "),i("div",{staticClass:"other"},[i("div",{staticClass:"price"},[t._v("￥"+t._s(e.price))]),t._v(" "),i("div",{staticClass:"num"},[t._v("x"+t._s(e.count))])])])])]})],2),t._v(" "),i("div",{staticClass:"ms-cbfooter"},[i("div",{staticClass:"ms-cbtext"},[t._v("共"+t._s(t.cartList.length)+"件商品")]),t._v(" "),i("div",{staticClass:"ms-cbtext large"},[t._v("合计:\n\t\t\t\t\t"),i("span",[t._v("￥"+t._s(t.allPrice))])])])])]),t._v(" "),i("footer",{ref:"footerEl",staticClass:"ms-clearing-footer"},[i("div",{staticClass:"price"},[i("div",{staticClass:"price-all"},[t._v("\n\t\t\t\t需付:\n\t\t\t\t"),i("span",[i("i",[t._v("￥")]),t._v(t._s(t.needPayPrice.split(".")[0])),i("i",[t._v("."+t._s(t.needPayPrice.split(".")[1]))])])]),t._v(" "),i("div",{staticClass:"price-discount"},[t._v("\n\t\t\t\t优惠:\n\t\t\t\t"),i("span",[i("i",[t._v("￥")]),t._v(t._s(t.realDiscountPrice.split(".")[0])),i("i",[t._v("."+t._s(t.realDiscountPrice.split(".")[1]))])])])]),t._v(" "),i("ask-button",{staticClass:"discount",attrs:{hover:!1,text:"折扣"},nativeOn:{click:function(e){t.discountModalShow=!0}}}),t._v(" "),i("ask-button",{attrs:{hover:!1,text:"结算"},nativeOn:{click:function(e){return t.pay(e)}}})],1),t._v(" "),i("ask-modal",{staticClass:"member-clearing",attrs:{show:t.show,title:"",showFooter:!1,showHeader:!1,beforeClose:t.closeModal},on:{"update:show":function(e){t.show=e}}},[i("div",{staticClass:"mc-box"},[i("div",{staticClass:"mc-once",on:{click:function(e){t.chooseType(3)}}},[i("div",{staticClass:"icon"},[i("img",{attrs:{src:s("RZvp"),alt:"图标"}})]),t._v(" "),i("div",{staticClass:"text"},[t._v("扫付款码")])]),t._v(" "),i("div",{staticClass:"mc-once",on:{click:function(e){t.chooseType(1)}}},[i("div",{staticClass:"icon"},[i("img",{attrs:{src:s("hcCh"),alt:"图标"}})]),t._v(" "),i("div",{staticClass:"text"},[t._v("会员手机")])])])]),t._v(" "),i("ask-modal",{staticClass:"member-info",attrs:{show:t.memberShow,title:"",showFooter:!1,showHeader:!1},on:{"update:show":function(e){t.memberShow=e}}},[i("div",{staticClass:"mi-box"},[i("div",{staticClass:"mi-once"},[i("input",{directives:[{name:"model",rawName:"v-model",value:t.modelData.phone,expression:"modelData.phone"}],attrs:{type:"text",placeholder:"请输入手机号"},domProps:{value:t.modelData.phone},on:{input:function(e){e.target.composing||t.$set(t.modelData,"phone",e.target.value)}}})]),t._v(" "),i("div",{staticClass:"mi-once"},[i("ask-button",{staticClass:"verif",attrs:{hover:!1,text:t.codeText,disabled:t.codeDisabled},nativeOn:{click:function(e){return t.sendCode(e)}}}),t._v(" "),i("input",{directives:[{name:"model",rawName:"v-model",value:t.modelData.verif,expression:"modelData.verif"}],attrs:{type:"text",placeholder:"请输入验证码"},domProps:{value:t.modelData.verif},on:{input:function(e){e.target.composing||t.$set(t.modelData,"verif",e.target.value)}}})],1),t._v(" "),i("div",{staticClass:"mi-once btn"},[i("ask-button",{directives:[{name:"show",rawName:"v-show",value:t.sureButton,expression:"sureButton"}],attrs:{hover:!1,text:"确定"},nativeOn:{click:function(e){return t.usePhoneGetInfo(e)}}}),t._v(" "),i("ask-button",{attrs:{hover:!1,text:"取消"},nativeOn:{click:function(e){return t.closeMemberModal(e)}}})],1)])]),t._v(" "),i("ask-modal",{staticClass:"discont-modal",attrs:{show:t.discountModalShow,title:"",showFooter:!1,showHeader:!1},on:{"update:show":function(e){t.discountModalShow=e}}},[i("div",{staticClass:"dm-box"},[i("div",{staticClass:"dm-title"},[t._v("整单折扣")]),t._v(" "),i("div",{staticClass:"dm-once"},[i("div",{staticClass:"dm-name"},[t._v("原价：")]),t._v(" "),i("div",{staticClass:"dm-value"},[t._v("￥"+t._s(t.allPrice))])]),t._v(" "),i("div",{staticClass:"dm-once"},[i("div",{staticClass:"dm-name"},[t._v("优惠：")]),t._v(" "),i("div",{staticClass:"dm-value"},[i("input",{directives:[{name:"model",rawName:"v-model",value:t.discountPrice,expression:"discountPrice"}],attrs:{type:"number",placeholder:"请输入折扣价"},domProps:{value:t.discountPrice},on:{input:[function(e){e.target.composing||(t.discountPrice=e.target.value)},t.cancelDiscountChoose]}}),t._v("元\n\t\t\t\t")])]),t._v(" "),i("div",{staticClass:"dm-once"},[i("div",{staticClass:"dm-name"},[t._v("折扣：")]),t._v(" "),i("div",{staticClass:"dm-value"},[i("span",{class:{active:t.discountNeddActive&&.9==t.discount},on:{click:function(e){t.changeDiscount(.9)}}},[t._v("9折")]),t._v(" "),i("span",{class:{active:t.discountNeddActive&&.85==t.discount},on:{click:function(e){t.changeDiscount(.85)}}},[t._v("85折")]),t._v(" "),i("span",{class:{active:t.discountNeddActive&&.75==t.discount},on:{click:function(e){t.changeDiscount(.75)}}},[t._v("75折")]),t._v(" "),i("span",{class:{active:t.discountNeddActive&&.7==t.discount},on:{click:function(e){t.changeDiscount(.7)}}},[t._v("7折")])])]),t._v(" "),i("div",{staticClass:"dm-once btn"},[i("ask-button",{attrs:{hover:!1,text:"取消"},nativeOn:{click:function(e){t.discountModalShow=!1}}}),t._v(" "),i("ask-button",{attrs:{hover:!1,text:"确定"},nativeOn:{click:function(e){return t.sureDiscountModal(e)}}})],1)])])],1)},staticRenderFns:[function(){var t=this.$createElement,e=this._self._c||t;return e("div",{staticClass:"ms-cbtitle"},[e("div",{staticClass:"icon"},[e("i",{staticClass:"iconfont icon-dianpu"})]),this._v(" "),e("div",{staticClass:"name"},[this._v("苏银商户")])])}]};var C=s("Z0/y")(f,p,!1,function(t){s("CduL")},null,null);e.default=C.exports},rDpa:function(t,e){},tHyW:function(t,e,s){"use strict";var i={name:"SlideSub",props:{show:!1},mounted:function(){if(this.show){var t=this.$el.querySelector(".slide-sub-info").offsetHeight;this.$el.style.height=t+"px"}},methods:{beforeEnter:function(t){t.style.height="0px"},enter:function(t,e){var s=t.querySelector(".slide-sub-info").offsetHeight;t.style.height=s+"px",e()},beforeLeave:function(t){var e=t.querySelector(".slide-sub-info").offsetHeight;t.style.height=e+"px"},leave:function(t,e){t.style.height="0px",setTimeout(function(){e()},300)}}},a={render:function(){var t=this.$createElement,e=this._self._c||t;return e("transition",{on:{"before-enter":this.beforeEnter,enter:this.enter,"before-leave":this.beforeLeave,leave:this.leave}},[e("div",{directives:[{name:"show",rawName:"v-show",value:this.show,expression:"show"}],staticClass:"slide-sub"},[e("div",{staticClass:"slide-sub-info"},[this._t("default")],2)])])},staticRenderFns:[]};var n=s("Z0/y")(i,a,!1,function(t){s("rDpa")},null,null);e.a=n.exports}});