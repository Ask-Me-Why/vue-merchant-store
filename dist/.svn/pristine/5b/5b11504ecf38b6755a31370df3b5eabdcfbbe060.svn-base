webpackJsonp([2],{"4IMJ":function(e,t){},CZUd:function(e,t){e.exports="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAF8AAABOCAMAAABxGDr5AAAABGdBTUEAALGPC/xhBQAAAAFzUkdCAK7OHOkAAABjUExURUxpcfyLPv/fyP/gy/yLPv6rdf2NQvyMQfyNQv2fYf7bw//eyP2NQv/dxv/awv2RR/2MQP/hzP2MP/6OQfyNQfyMQP2NQf69kfyNQv7dxvyHOP/k0v7XvP2WUf7Rsv20gf7FnpABYysAAAAYdFJOUwDjTd0oGNlM8wu/b5iJL12+nWx6p4eRk6PgLokAAAM6SURBVFjD1ZmLcqsgEIbRqFwU8ZKLiWnS93/KAt7AsKfGwJnpP3XGpPCJu8suEIS8iMY5z1MURGnM2VUrD8j2/4Ayrw/XlUpP5naxlbgPk+TMyVZin5sbZGvR/ea2XQko9uZKt/KA7LcdQJUr+7d02OJFLWnux/1tXXE6CXB1k3Wf6DbfRcfEMfZqbngb/vS13P16mcIvs/J563wqsWdl/+0X3x2HMJlmZe95+F0k8XwJb+98glBtzI4A/Pgals8C869/nB/aPvz6t+MnDcy3HPAf5u+i19S+WUsfZDnAOf6hSxRF22vMzRi/5YD7YxTjeZmMkpWOluLCHht1Z+nUVeV/c3Uw1Og6L1+WEG9Veau36YADy2Nqr6pq1r8ta3i5wdZbBDooVez7HvWXCaHGWiq2NIm6b6JF5Gu3uomRqeHyxdynffEIB+hqeXLyP7/MxffhGYg/7qP6IHw6ryDC8JcZFojP3XxCiB9+7OZHMn/YSU1grL+IMBbTChDPEk1FnPwUsI/MTmfzcyWb6hs5bej43cmK7+TojB/m5svVaWINH6Ghf0bnfxTyUYneTyQ6cVUuPnfzieyRWR8pcfAbMkhvKFLi4MdA/DQItdbrNJ2DvzSJ0ukNbX4J8DPLQHh+m9X4lyYtQsI1fw9A/CeGQY2HgXz5itjFrwH+2egtx1b8xi+A8ecAX7o0Xd6Fkt/4YpXiJ34J5QcxG6gyQJB/1XYrc+ZnaP9VzS8sjK42X2Ra1VE2sc2z8Gsov01WIdQIJZuP6HipCUzc/Bzit2NEH81cseIvJaolQP0qIX42RhxevLvmJ+2g4iW9GfURzP9yVkV6I2tYdmX/LfWXQfyjDvuTlblsPt7CzyE+SRUgsTLpDn4M1keZ5JR5zp/xKciXHq4KRKPP+AhenyQIY9uJe/gc5BcvdWkPPwb5qlGyNplRf7fxU3j9UzTCLqtR20xpshLivG39yYKtr2YHBOXHgflpYL6sMWH5tf/zyWq1key//D7AOsCVNaZ/dDePT2jt3Z0s8v392d3+dcjxhjKx2j3qFNQ/vmexi8C79Xp6Tg/zGUTfMx6X3n+OY+NJAY8D/ZgYcz6cFHjSD1cNAN5p08sVAAAAAElFTkSuQmCC"},RZvp:function(e,t){e.exports="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAE8AAABHBAMAAAC0SQfYAAAABGdBTUEAALGPC/xhBQAAAAFzUkdCAK7OHOkAAAAkUExURUxpcSWr7CWr7CWr7CWr7CWr7CWr7CWr7CWr7CWr7CWr7CWr7PuHNrkAAAALdFJOUwAg7Z1tPbiES9MKh78kvwAAAYhJREFUSMft1L9PwkAUB/BXDaCdqotGFidjZGFnYXCiC4MkJixEk4vYhc1ElqKRXGRpjIthIcaB1QIJ+P45+wvKtX3XDg4O/U7k+uHuXq/3ANwYuACoIc4BytiDPiJ2QLGhPCsg/kCYmgxeJMNDB+o5zGEOcxiHBi6jLcUCBYXeM2TsFq75K8Ax5wOAKdfcX7wJ6gtMByrnZokxZnr/Bnl2HFL1Z3x+eCSQ2mpp7oz1dTHfBNxDZ89h+gFUDsKceCNOMfU4PHrDMPY7CQsVFHJPwU/R4YyC/QjEJgHHUdj7C7iux06DjeAtfqVBKxjZT4MrzT+icTL0z9pwH557A0/eRuuxs766bHjczd0E1KFfkenMyLpm7EvR/cdn7CYoXSM+qXbkNa6oLznprBOzG4FLChYi8JS8RePYURMZCc6ekLAowDl9gRUBWpKrrm9DTQKL2VYW1+5I28woS83i2kt541I3PaCa0uLa2VYGKAVwAWmpZKl5C6ZtcVPNv4aYsWq1++Eldg1+AZaO1/eJlHgkAAAAAElFTkSuQmCC"},a5E9:function(e,t){},hcCh:function(e,t){e.exports="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAE8AAABSCAMAAAAionnxAAAABGdBTUEAALGPC/xhBQAAAAFzUkdCAK7OHOkAAAB+UExURUxpcVl2yHuS1MLO7T1fvvD1/Zms3v///93l9zhavUtqw0FiwEhowkpqwzdZvEpqw+br+Etrw3iQ05Ck205txZqt39zl9////+nw++70/eTr+URlwSpPuIGY1nKL0ff5/TdavdXf9ExrxFd1yLvJ64+j26++5mWAzaGz4cnV8EZ8GboAAAAWdFJOUwB2dnP+c3Nzc3G0WezdOs98lru0H6p1rE34AAAEW0lEQVRYw+2Zi5KqOBCGBwmKCDo6nhgSIHKH93/B04SLkISLM1O1W1v7T1llofPZSXeH7ubjQ+hsXB2NLpKc6+n+sa779eIi9NQITfREruecV3Enhz1ZWkYahaDo9VcmCF2MNZyHUFlldawTjvFIcREy5C4DzxfE8pj4U/GHEJcu+7hKkHta2juHsZxygqeihAqRqYGU+wC8LDjl5KIIc5mGs6pVJn2COclRsmCgg9KMU+mf/LoMGt8+g7L2pZ/y6xQ58wZ6KIp9vJ2HCQ2RNx80LsqpwqM0y1tlVLadkJwteMQFb5DWAz4Z5PPWs3ziYNLyKsbWeYRq4y+uR8Kk5xlr6yVxNUmMUqewJnTVPsEjNGfBqp4hWLiBB18Ch6a65H0pD+Er4O2NvDSAH5+q8ccoA0kOPPIGz38siudv2kf+5ym8zh/Xk6Lz/X1eknU8x1B1FPeqV/yt8qrnwPsyhWzb7N7AayeAHS9+j/fHPnSyBtkAHPLtTd4XWLZvZL90AOBZtY9rpPIs0zg2Mq2BZ8G1k8LDhUY1l9dr2XtjBzKtEdBWeXWJmCKUFFzeP0tWw9sdJR4JAw2PBWU85d32skwtj0YBS1QFqcRzjrLEyhUeL1Cgq4sqf8U+47jX8R6kCFXlBVX8cZhqN8MDIiXKuaqJl828tXimpEjY1+d/hden2GQH+Spv3/M8FOLReeBX3X1ycnPP8QrPmuHxCkk1uKjDu89evJs5kjVvn8gPkWKz+SF4k/N5Z8/yIH+19kVY4k1yzZzfv7psLEunSsrsscAz9PZFdDj/Mkmx7N9J/tqHBd734s/6Zd7P7RudzD+yj7b7t9vvBjUB+D0eKzreerxEv8vDb/JeqzWMvfVj3s0cFwaHH/NW4++HvG/ZV6DftW+BJ+w7/Mvt+4d5jxHvtoW3cv99ZB0vSzfxyrqd2cyqQqha4k38GwasbZrTWbHu/NPzdmMebEq63k+zHPc8W9LAu6CwmZdQmg3V3qwKTHHLU/qjY79/l27+AlUf7UZMIEqglRavVzUI1yie4xn7rn7ueT2wpRJOmglMQXn/K0K4593aXmvot5q3Em86tMFiPsHCmiiznnb/Dpa528GtV+4XtDzAPQOWJkEQxkTL+4SMbap6+9XOLPD8AlqOLM6iAFU+1fJM8AD0XGPgLI9QaHULaNsyMfXQrhcK0sPBhNplCw+iu4w55U0WxnqeSIitvM4+LuybX2/XxUx5z9n9w9r9I/Ah2KfzR9OvNvNJvX+TMn2qy23mfyhp+ksRL5bcTxtQ4BPVwFjEHwqV8STm0NJ6n00V1L6kfv9+AQMfVAHSIozCCsurxZyEKJmU45323YADDCxr7qtjTYq7jB37gkP3htyrdlzSTmDuV4bKjMqDa9HDNGfC5CKtQ4Y846xTP/M9O9DQh0WtKFNU5CUC3MoA/3z1EEpSZbypntAJQq5zWn9ecXI8F22Q612MLQ9AgKh5nnJVZKw+TvkL14TXkKFhHVIAAAAASUVORK5CYII="},hiPH:function(e,t,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a=s("4YfN"),i=s.n(a),n=s("lC5x"),o=s.n(n),c=s("J0Oq"),r=s.n(c),l=s("3cXf"),d=s.n(l),v=s("0xDb"),u=s("tHyW"),m=s("+vOg"),h=(s("IcnI"),s("VCXJ"),{name:"Clearing",inject:["rootMain"],components:{"slide-sub":u.a},data:function(){return{memberShow:!1,show:!1,member:{tip:"当前为普通收款，我要切换为",btn:"会员到店",type:1,id:null,name:"张某某",phone:"18751234562",code:null},modelData:{card:null,phone:null,verif:null},phoneRex:/^[1]{1}[34578]{1}[0-9]{9}$/,codeText:"验证码",codeDisabled:!1,sureButton:!1,infoStyle:{},posId:0}},computed:{cartList:function(){return this.$store.getters["cartModule/getAllCart"]},allPrice:function(){var e=0;return this.cartList.length>0&&(e=this.cartList.reduce(function(e,t){return e+t.count*Number(Object(v.n)(t.price))},0)),Object(v.d)(Object(v.n)(e))},orderData:function(){var e=[];return this.cartList.length>0&&this.cartList.map(function(t){e.push([t.id,t.count])}),d()(e)}},mounted:function(){var e=this.$refs.footerEl?this.$refs.footerEl.offsetHeight+20:74;e=e+.5|0,this.infoStyle={"padding-bottom":e+"px"}},methods:{chooseType:function(e){var t=this;return r()(o.a.mark(function s(){return o.a.wrap(function(s){for(;;)switch(s.prev=s.next){case 0:t.modelData={card:null,phone:null,verif:null},t.show=!1,3==e?t.$jsBridge.callHandler("launchScan",{title:"获取付款码"},function(e){e&&(t.modelData.card=e,t.useCardGetInfo({pay_code:t.modelData.card}))}):2==e?t.$jsBridge.callHandler("getMemberCardNo",{title:"获取会员卡号"},function(e){e&&(t.modelData.card=e,t.useCardGetInfo({card:t.modelData.card}))}):t.openMemberModal();case 3:case"end":return s.stop()}},s,t)}))()},openModal:function(){this.show=!0},closeModal:function(e){e()},openMemberModal:function(){this.memberShow=!0},closeMemberModal:function(){this.memberShow=!1,this.sureButton=!1},changeType:function(){var e={};1==this.member.type?this.openModal():(e.tip="当前为普通收款，我要切换为",e.btn="会员到店",e.type=1,this.member.order_code=null),this.member=Object(v.k)(!0,this.member,e)},validatePhone:function(){return this.modelData.phone?!!this.phoneRex.test(this.modelData.phone)||(Object(v.f)({msg:"手机号格式不对！",class:"danger",time:2e3}),!1):(Object(v.f)({msg:"请输入您的手机号！",class:"danger",time:2e3}),!1)},sendCode:function(){var e=this;if(this.validatePhone()){var t=new m.b;this.codeDisabled=!0;var s=60,a=setInterval(function(){s--,e.codeText=s+"s",(s<0||!e.memberShow)&&(e.codeText="验证码",e.codeDisabled=!1,clearInterval(a))},1e3);t.sendCode(this.modelData.phone).then(function(t){t.data.ok&&(Object(v.f)({msg:"验证码已发送",class:"success",time:2e3}),e.sureButton=!0)},function(e){Object(v.f)({msg:"网络请求错误",class:"success",time:2e3})})}},usePhoneGetInfo:function(){if(this.validatePhone())return this.modelData.verif?void this.useCardGetInfo({phone:this.modelData.phone,code:this.modelData.verif}):(Object(v.f)({msg:"请输入验证码",class:"danger",time:2e3}),!1)},useCardGetInfo:function(e){var t=this;(new m.b).getInfo(e).then(function(e){e.data.ok&&(t.member.tip="欢迎会员"+e.data.name+"到店",t.member.btn="普通收款",t.member.type=2,t.member.id=e.data.id,t.member.name=e.data.name,t.member.phone=e.data.phone,t.member.order_code=e.data.order_code,t.closeMemberModal())},function(e){Object(v.f)({msg:"网络请求错误",class:"success",time:2e3})})},pay:function(){var e=this,t={};t.order_code=this.member.order_code||"",t.amount=this.allPrice,t.goods_list=this.cartList.reduce(function(e,t){var s={goods_id:t.id,name:t.name,num:t.count,price:t.price,goods_no:t.goods_no};return e.push(s),e},[]),this.$jsBridge.isInit&&"no"==this.$jsBridge.isInit&&this.rootMain.loader(!1),this.$jsBridge.callHandler("buildGoodsOrder",i()({title:"pos支付"},t),function(t){e.$store.dispatch("cartModule/clearCart"),"string"==typeof t&&(t=JSON.parse(t)),1==t.retcode?e.$router.back():e.$router.askForward({path:"/order/0",query:e.$route.query})})}},beforeRouteLeave:function(e,t,s){"order"!=e.name?Object(v.e)({title:"提示",theme:"accent",content:"确认离开？",shadeClick:!1,showClose:!1},function(e){e.close(),s()},function(e){s(!1)}):s()},watch:{"modelData.phone":function(e,t){var s=(""+e).replace(/\D/g,"");s.length>11&&(s=s.substr(0,11)),this.modelData.phone=s}}}),f={render:function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{directives:[{name:"nav",rawName:"v-nav",value:e.$route.meta,expression:"$route.meta"}],staticClass:"ask-view"},[a("div",{staticClass:"ask-view-box",style:e.infoStyle},[a("header",{staticClass:"ms-clearing-header"},[a("div",{staticClass:"ms-chbar"},[a("div",{staticClass:"text",domProps:{textContent:e._s(e.member.tip)}}),e._v(" "),a("div",{staticClass:"btn"},[a("ask-button",{attrs:{hover:!1,text:e.member.btn},nativeOn:{click:function(t){e.changeType(t)}}})],1)]),e._v(" "),a("slide-sub",{staticClass:"ms-chinfo",attrs:{show:2==e.member.type}},[a("div",{staticClass:"ms-chonce"},[a("div",{staticClass:"name"},[e._v("姓名：")]),e._v(" "),a("div",{staticClass:"value",domProps:{textContent:e._s(e.member.name)}})]),e._v(" "),a("div",{staticClass:"ms-chonce"},[a("div",{staticClass:"name"},[e._v("电话：")]),e._v(" "),a("div",{staticClass:"value",domProps:{textContent:e._s(e.member.phone)}})])])],1),e._v(" "),a("section",{staticClass:"ms-clearing-body"},[e._m(0),e._v(" "),a("div",{staticClass:"ms-cbinfo"},[e._l(e.cartList,function(t,s){return[a("div",{staticClass:"ms-cbgroup"},[a("div",{staticClass:"cover"},[a("div",{staticClass:"cover-box"},[a("img",{attrs:{src:t.pic,alt:"封面图"}})])]),e._v(" "),a("div",{staticClass:"detail"},[a("div",{staticClass:"title"},[e._v(e._s(t.name))]),e._v(" "),a("div",{staticClass:"other"},[a("div",{staticClass:"price"},[e._v("￥"+e._s(t.price))]),e._v(" "),a("div",{staticClass:"num"},[e._v("x"+e._s(t.count))])])])])]})],2),e._v(" "),a("div",{staticClass:"ms-cbfooter"},[a("div",{staticClass:"ms-cbtext"},[e._v("共"+e._s(e.cartList.length)+"件商品")]),e._v(" "),a("div",{staticClass:"ms-cbtext large"},[e._v("合计:\n\t\t\t\t\t"),a("span",[e._v("￥"+e._s(e.allPrice))])])])])]),e._v(" "),a("footer",{ref:"footerEl",staticClass:"ms-clearing-footer"},[a("div",{staticClass:"price"},[e._v("\n\t\t\t合计:\n\t\t\t"),a("span",[a("i",[e._v("￥")]),e._v(e._s(e.allPrice.split(".")[0])),a("i",[e._v("."+e._s(e.allPrice.split(".")[1]))])])]),e._v(" "),a("ask-button",{attrs:{hover:!1,text:"结算"},nativeOn:{click:function(t){e.pay(t)}}})],1),e._v(" "),a("ask-modal",{staticClass:"member-clearing",attrs:{show:e.show,title:"",showFooter:!1,showHeader:!1,beforeClose:e.closeModal},on:{"update:show":function(t){e.show=t}}},[a("div",{staticClass:"mc-box"},[a("div",{staticClass:"mc-once",on:{click:function(t){e.chooseType(3)}}},[a("div",{staticClass:"icon"},[a("img",{attrs:{src:s("RZvp"),alt:"图标"}})]),e._v(" "),a("div",{staticClass:"text"},[e._v("扫付款码")])]),e._v(" "),a("div",{staticClass:"mc-once",on:{click:function(t){e.chooseType(2)}}},[a("div",{staticClass:"icon"},[a("img",{attrs:{src:s("CZUd"),alt:"图标"}})]),e._v(" "),a("div",{staticClass:"text"},[e._v("会员卡")])]),e._v(" "),a("div",{staticClass:"mc-once",on:{click:function(t){e.chooseType(1)}}},[a("div",{staticClass:"icon"},[a("img",{attrs:{src:s("hcCh"),alt:"图标"}})]),e._v(" "),a("div",{staticClass:"text"},[e._v("会员手机")])])])]),e._v(" "),a("ask-modal",{staticClass:"member-info",attrs:{show:e.memberShow,title:"",showFooter:!1,showHeader:!1},on:{"update:show":function(t){e.memberShow=t}}},[a("div",{staticClass:"mi-box"},[a("div",{staticClass:"mi-once"},[a("input",{directives:[{name:"model",rawName:"v-model",value:e.modelData.phone,expression:"modelData.phone"}],attrs:{type:"text",placeholder:"请输入手机号"},domProps:{value:e.modelData.phone},on:{input:function(t){t.target.composing||e.$set(e.modelData,"phone",t.target.value)}}})]),e._v(" "),a("div",{staticClass:"mi-once"},[a("ask-button",{staticClass:"verif",attrs:{hover:!1,text:e.codeText,disabled:e.codeDisabled},nativeOn:{click:function(t){e.sendCode(t)}}}),e._v(" "),a("input",{directives:[{name:"model",rawName:"v-model",value:e.modelData.verif,expression:"modelData.verif"}],attrs:{type:"text",placeholder:"请输入验证码"},domProps:{value:e.modelData.verif},on:{input:function(t){t.target.composing||e.$set(e.modelData,"verif",t.target.value)}}})],1),e._v(" "),a("div",{staticClass:"mi-once btn"},[a("ask-button",{directives:[{name:"show",rawName:"v-show",value:e.sureButton,expression:"sureButton"}],attrs:{hover:!1,text:"确定"},nativeOn:{click:function(t){e.usePhoneGetInfo(t)}}}),e._v(" "),a("ask-button",{attrs:{hover:!1,text:"取消"},nativeOn:{click:function(t){e.closeMemberModal(t)}}})],1)])])],1)},staticRenderFns:[function(){var e=this.$createElement,t=this._self._c||e;return t("div",{staticClass:"ms-cbtitle"},[t("div",{staticClass:"icon"},[t("i",{staticClass:"iconfont icon-dianpu"})]),this._v(" "),t("div",{staticClass:"name"},[this._v("苏银商户")])])}]};var A=s("Z0/y")(h,f,!1,function(e){s("a5E9")},null,null);t.default=A.exports},tHyW:function(e,t,s){"use strict";var a={name:"SlideSub",props:{show:!1},mounted:function(){if(this.show){var e=this.$el.querySelector(".slide-sub-info").offsetHeight;this.$el.style.height=e+"px"}},methods:{beforeEnter:function(e){e.style.height="0px"},enter:function(e,t){var s=e.querySelector(".slide-sub-info").offsetHeight;e.style.height=s+"px",t()},beforeLeave:function(e){var t=e.querySelector(".slide-sub-info").offsetHeight;e.style.height=t+"px"},leave:function(e,t){e.style.height="0px",setTimeout(function(){t()},300)}}},i={render:function(){var e=this.$createElement,t=this._self._c||e;return t("transition",{on:{"before-enter":this.beforeEnter,enter:this.enter,"before-leave":this.beforeLeave,leave:this.leave}},[t("div",{directives:[{name:"show",rawName:"v-show",value:this.show,expression:"show"}],staticClass:"slide-sub"},[t("div",{staticClass:"slide-sub-info"},[this._t("default")],2)])])},staticRenderFns:[]};var n=s("Z0/y")(a,i,!1,function(e){s("4IMJ")},null,null);t.a=n.exports}});